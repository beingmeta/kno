#!/usr/bin/env fdexec
;;; -*- Mode: fdscript; -*-

;;; Copyright (C) 2002, beingmeta, inc.
;;; $Id: spider-repack,v 1.1 2002/04/12 20:21:30 haase Exp $

;;; This script resets all of a spiders data files, removing history
;;; files.  Note that this does not touch background pools or indices.

;;; Initialization

(use-module 'load-utils)
(use-module 'fdtext)

(set-notify! #t)

;;; This script resets all of the spider data and control files in the
;;; designated (or current) directory
;;; $Id: spider-repack,v 1.1 2002/04/12 20:21:30 haase Exp $

(define (repack-file-index filename)
  (when (file-exists? filename)
    (system "repack-file-index " filename)))

(define (main (dir "."))
  ;; Remove or reset pools and files
  (let ((dir (add-slash (if (equal? dir ".") (pwd) dir))))
    (do-choices (file (getfiles dir))
      (cond ((tx-match (vector dir "content" '(isdigit+) ".pool") file)
	     (notify "Resetting file pool " file)
	     (system "repack-file-pool " file))
	    ((tx-match (vector dir "content" '(isdigit+) ".index") file)
	     (repack-file-index file))))
    ;; Reset anciallary indices
    (repack-file-index (newpath dir "md5.index"))
    (repack-file-index (newpath dir "premium.index"))
    (repack-file-index (newpath dir "concepts.index"))
    (repack-file-index (newpath dir "summaries.index"))
    (when (file-exists? (newpath dir "langmap.index"))
      (repack-file-index (newpath dir "langmap.index")))))

(define (add-slash dir)
  (if (has-suffix "/" dir) dir (string-append dir "/")))

;;; $Log: spider-repack,v $
;;; Revision 1.1  2002/04/12 20:21:30  haase
;;; Spider repacking script
;;;  

