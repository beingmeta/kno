#!/usr/bin/env fdexec
;;; -*- Mode: fdscript; -*-

;;; Copyright (C) 2002, beingmeta, inc.
;;; $Id: spider-retry,v 1.5 2003/05/17 19:02:29 haase Exp $

;;; This script copies failure or error records for the spider
;;; back to the urlqueue.

(use-module 'load-utils)

(define (main (dir ".") (type "err"))
  (let* ((dir (if (equal? dir ".") (pwd) dir))
	 (suffix (if (eqv? (elt type 0) #\.) type (string-append "." type)))
	 (redo (elt (read-dtype-from-file (newpath dir "urlqueue" suffix))
		    1))
	 (history-dir (newpath dir "history"))
	 (moment (iso-timestring)))
    (copy-binary-file (newpath dir "urlqueue" suffix)
		      (newpath history-dir moment suffix))
    (write-dtype-to-file
     redo (newpath history-dir moment
		   (string-append suffix "-redo")))
    (add-dtype-to-file redo "urlqueue")
    (remove-file (stringout "urlqueue" suffix))))

;;; $Log: spider-retry,v $
;;; Revision 1.5  2003/05/17 19:02:29  haase
;;; Fix break pattern
;;;
;;; Revision 1.4  2002/04/12 19:53:13  haase
;;; Minor updates, copyright notices, etc
;;;
;;; Revision 1.3  2002/04/10 19:13:27  haase
;;; Numerous spider toolscripts update
;;;
;;; Revision 1.2  2002/04/04 17:09:29  haase
;;; Added headers and RCS keywords
;;;  

