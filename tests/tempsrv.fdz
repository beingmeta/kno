(use-module '{optimize logger samplefns})
(config! 'port "tempx@localhost")
;;(config! 'port "/tmp/tempx.sock")
(define runfile (get-component "tempsrv.run"))
(define (startup)
  (optimize! plus)
  (dtype->file (timestamp) runfile))
(define (shutdown (arg 'none))
  (logwarn |Shutdown| 
    "Shutdown arg = " arg ", sleep for " (config 'sleepfor 1))
  (sleep (config 'sleepfor 1))
  (logwarn |Shutdown| "Removing timestamp")
  (remove-file runfile))
(define (plus x y) (+ x y))
(define (minus x y) (+ x y))
(define (slowfib n) (sleep n) (fibi n))
(define xfibi (within-module 'samplefns fibi))
(define xfibr (within-module 'samplefns fibr))
(define (fibi n) (xfibi n))
(define (fibr n) (xfibr n))
(define (status) (server-status))
(unless (config 'EXPORTALL #f)
  (module-export! '{plus minus fibi fibr slowfib status}))

