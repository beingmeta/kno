#!/bin/sh

if test $# -eq 0; then
   echo "Usage: runtest <program> [args...]";
   exit;
fi
PROGNAME=$1; shift;
LOGFILE=$$.log

FD_LOADPATH=../../src/scheme/%/module.scm:../../src/scheme/%.scm:
export FD_LOADPATH
FD_DLOADPATH=../../lib/framerd
export FD_DLOADPATH
LD_LIBRARY_PATH=../../lib
export LD_LIBRARY_PATH
DYLD_LIBRARY_PATH=../../lib
export DYLD_LIBRARY_PATH
PPROF_PATH=@GOOGLE_PPROF@
export PPROF_PATH
FD_SKIP_DOTLOAD=yes
export FD_SKIP_DOTLOAD
FD_SHOWTIME=0.0
export FD_SHOWTIME
FD_DISPLAYMAXELTS=36=
export FD_DISPLAYMAXELTS=36
FD_DISPLAYMAXCHARS=1024=
export FD_DISPLAYMAXCHARS=1024
if test $# -eq 0; then
   echo "Usage: runtest <program> [args...]";
   exit;
fi

if test ! -z ${PREAMBLE}; then
   echo "TEST: " ${PROGNAME} $*;
fi;

if @test_env@ ${PROGNAME} $* > ${LOGFILE}; then
   echo "SUCCESS:" ${PROGNAME} $*;
   cat ${LOGFILE} >> success.log
   rm ${LOGFILE};
   exit 0
else
    echo "FAILURE:" ${PROGNAME} $*;
    echo Log file in ${LOGFILE};
    cat ${LOGFILE} >> failure.log
    exit 1
fi;

