#!/bin/sh

if test $# -eq 0; then
   echo "Usage: runtest <program> [args...]";
   exit;
fi
PROGNAME=$1; shift;
LOGFILE=$$.log
LOGTIME=t$$.elapsed

if test ! -z ${PREAMBLE}; then
   echo "TEST: " ${PROGNAME} $*;
fi;

. ./runenv.sh

if @test_env@ ${PROGNAME} $* LOGTIME=${LOGTIME} > ${LOGFILE}; then
    if test -f ${LOGTIME}; then
	echo "SUCCESS:" ${PROGNAME} $* "("$(cat ${LOGTIME})"s)";
	rm ${LOGTIME};
    else echo "SUCCESS:" ${PROGNAME} $*; fi
   cat ${LOGFILE} >> success.log
   rm ${LOGFILE};
   exit 0
else
    echo "FAILURE:" ${PROGNAME} $*;
    echo Log file in ${LOGFILE};
    cat ${LOGFILE} >> failure.log
    exit 1
fi;

