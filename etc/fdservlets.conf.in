start on (net-device-up and
          local-filesystems and
	  runlevel [345] and
          rc started)
stop on runlevel [!2345]

author "Ken Haase"
description "FramerD servlets"
expect none
console log

pre-start script
   mkdir -p @rundir@/fdserv
   mkdir -p @logdir@/fdserv
   chown @webuser@ @rundir@/fdserv @logdir@/fdserv
   chgrp @admin_group@ @rundir@/fdserv @logdir@/fdserv
   chmod g+rwx @rundir@/fdserv  @logdir@/fdserv
end script

post-start script
   for sock in $(find @config_dir@/servlets/ -name "*.sock" -mindepth 1 -maxdepth 1);
     do if (readlink ${sock}>/dev/null);
        then touch @rundir@/fdserv/`basename ${sock}`.nospawn;
	     LOGFILE=@logdir@/fdserv/`basename ${sock} .sock`.log \
               fdservlet @rundir@/fdserv/`basename ${sock}` CONFIG=`readlink ${sock}` \
	         STATEDIR=@rundir@/fdserv RESTART=1 PIDWAIT=no;
        else touch @rundir@/fdserv/`basename ${sock}`.nospawn;
	     LOGFILE=@logdir@/fdserv/`basename ${sock} .sock`.log \
 	       fdservlet @rundir@/fdserver/`basename ${sock}` CONFIG=${sock} \
	         STATEDIR=@rundir@/fdserv RESTART=1 PIDWAIT=no; fi;
     done;
end script

post-stop script
   for ppid in @rundir@/fdserv/*.ppid;
       do kill `cat $ppid` || true; 
          rm -f  @rundir@/fdserv/`basename $ppid .ppid`.nospawn
       done
end script




