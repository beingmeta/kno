#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# This has to be exported to make some magic below work.
export DH_OPTIONS

%:
	dh $@ --with autotools-dev --with elpa --with systemd --parallel

override_dh_auto_configure:
	dh_auto_configure -- --libdir=$(DESTDIR)/usr/lib 	\
		--without-sudo --with-bootsystem=allboot 	\
		--with-make-target=packaged		 	\
		--with-parseltongue				\
		--with-libscm=version			 	\
                --with-malloc=jemalloc

override_dh_auto_install:
	make DESTDIR=$$(pwd)/debian/tmp install install-fdserv install-i18n \
		setup-upstart setup-sysv setup-systemd setup-logrotate

override_dh_install:
	dh_install
	dh_elpa --byte-compile

override_dh_shlibdeps:
	dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info

override_dh_strip:
	dh_strip -pframerd-core --dbg-package=framerd-core-dbg
	dh_strip -pframerd-sqlite --dbg-package=framerd-sqlite-dbg
	dh_strip -pframerd-mysql --dbg-package=framerd-mysql-dbg
	dh_strip -pframerd-mongodb --dbg-package=framerd-mongodb-dbg
	dh_strip -pframerd-leveldb --dbg-package=framerd-leveldb-dbg
	dh_strip -pframerd-sundown --dbg-package=framerd-sundown-dbg
	dh_strip -pframerd-tidy --dbg-package=framerd-tidy-dbg
	dh_strip -pframerd-imagetools --dbg-package=framerd-imagetools-dbg
