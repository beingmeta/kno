#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# This has to be exported to make some magic below work.
export DH_OPTIONS

%:
	dh $@ --with elpa --with systemd --parallel

override_dh_auto_configure:
	dh_auto_configure -- --libdir=$(DESTDIR)/usr/lib 	\
		--without-sudo --with-bootsystem=allboot 	\
		--with-make-target=packaged		 	\
		--with-parseltongue				\
		--with-libscm=version			 	\
                --with-malloc=jemalloc

override_dh_make:
	make distribution docs

override_dh_auto_install:
	make DESTDIR=$$(pwd)/debian/tmp install install-i18n install-docs \
		setup-upstart setup-sysv setup-systemd setup-logrotate

override_dh_install:
	dh_install
	dh_elpa --byte-compile

override_dh_shlibdeps:
	dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info

override_dh_strip:
	dh_strip -pkno-core       --dbg-package=kno-core-dbg
	dh_strip -pkno-sqlite     --dbg-package=kno-sqlite-dbg
	dh_strip -pkno-mysql      --dbg-package=kno-mysql-dbg
	dh_strip -pkno-leveldb    --dbg-package=kno-leveldb-dbg
	dh_strip -pkno-imagetools --dbg-package=kno-imagetools-dbg
	dh_strip -pkno-parseltongue --dbg-package=kno-parseltongue-dbg
	dh_strip -pkno-parseltongue2 --dbg-package=kno-parseltongue2-dbg
	dh_strip -pkno-zeromq     --dbg-package=kno-zeromq-dbg
